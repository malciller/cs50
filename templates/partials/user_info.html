<div class="container my-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="d-flex justify-content-between mb-3">
                <!-- Update Email Button -->
                <button title="Update Email Address" type="button" class="btn btn-info" id="updateEmailButton">
                    <img src="{{ url_for('static', filename='images/icons8-contacts.svg') }}" alt="Update Email Icon"
                        style="width: 20px; height: 20px;">
                </button>
                <!-- Password Reset Button -->
                <button title="Update Password" type="button" class="btn btn-info" id="resetPasswordButton">
                    <img src="{{ url_for('static', filename='images/icons8-support.svg') }}" alt="Reset Password Icon"
                        style="width: 20px; height: 20px;">
                </button>
                <!-- Update API Key Button -->
                <button title="Update API Key" type="button" class="btn btn-info" id="updateApiKeyButton">
                    <img src="{{ url_for('static', filename='images/icons8-key.svg') }}" alt="Update API Key Icon"
                        style="width: 20px; height: 20px;">
                </button>
                <!-- Delete button -->
                <button title="Delete Account" type="button" class="btn btn-danger" id="deleteAccountButton">
                    <img src="{{ url_for('static', filename='images/icons8-trash-can.svg') }}" alt="Delete Account Icon"
                        style="width: 20px; height: 20px;">
                </button>
            </div>

            <div class="user-info mb-3">
                <p><strong>Username:</strong> {{ username }}</p>
                <p><strong>Email:</strong> {{ email }}</p>
            </div>

    <!-- Update Email Form (Initially Hidden) -->
    <form action="{{ url_for('update_email') }}" method="post" style="display: none;" id="updateEmailForm">
        <div class="form-group">
            <label for="newEmail">New Email:</label>
            <input type="email" class="form-control" id="newEmail" name="new_email" required>
        </div>
        <div class="form-group">
            <label for="confirmEmail">Confirm New Email:</label>
            <input type="email" class="form-control" id="confirmEmail" name="confirm_email" required>
        </div>
        <button title="Update Email Address" type="submit" class="btn btn-primary"><img src="static\images\icons8-done.svg" alt="Delete Account Icon" style="width: 20px; height: 20px;">
        </button>
        <!-- Cancel Button -->
            <button title="Cancel" type="button" class="btn btn-secondary" id="cancelEmailUpdate" style="margin-left: 10px;">
                <img src="static\images\icons8-close.svg" alt="Delete Account Icon" style="width: 20px; height: 20px;">
            </button>
    </form>

    <!-- Password Reset Form (Initially Hidden) -->
    <form action="{{ url_for('reset_password') }}" method="post" style="display: none;" id="resetPasswordForm">
        <div class="form-group">
            <label for="currentPassword">Current Password:</label>
            <input type="password" class="form-control" id="currentPassword" name="current_password" required>
        </div>
        <div class="form-group">
            <label for="newPassword">New Password:</label>
            <input type="password" class="form-control" id="newPassword" name="new_password" required>
        </div>
        <div class="form-group">
            <label for="confirmPassword">Confirm New Password:</label>
            <input type="password" class="form-control" id="confirmPassword" name="confirm_password" required>
        </div>
        <button title="Update Password" type="submit" class="btn btn-primary"><img src="static\images\icons8-done.svg" alt="Delete Account Icon" style="width: 20px; height: 20px;">
        </button>
        <!-- Cancel Button -->
        <button title="Cancel" type="button" class="btn btn-secondary" id="cancelPasswordUpdate"
            style="margin-left: 10px;"><img src="static\images\icons8-close.svg" alt="Delete Account Icon" style="width: 20px; height: 20px;">
            </button>
    </form>


    <!-- Update API Key Form (Initially Hidden) -->
    <form action="{{ url_for('update_api_key') }}" method="post" style="display: none;" id="updateApiKeyForm">
        <div class="form-group">
            <label for="newApiKey">New API Key:</label>
            <input type="text" class="form-control" id="newApiKey" name="new_api_key" required>
        </div>
        <button title="Update API Key" type="submit" class="btn btn-primary"><img src="static\images\icons8-done.svg" alt="Delete Account Icon" style="width: 20px; height: 20px;">
        </button>
        <!-- Cancel Button -->
        <button title="Cancel" type="button" class="btn btn-secondary" id="cancelApiKeyUpdate"
            style="margin-left: 10px;"><img src="static\images\icons8-close.svg" alt="Delete Account Icon" style="width: 20px; height: 20px;">
            </button>
    </form>


<!-- Delete Account Form (Initially Hidden) -->
<form action="{{ url_for('delete_account') }}" method="post" style="display: none;" id="deleteAccountForm">
    <div class="form-group">
        <label for="deleteUsername">Username:</label>
        <input type="text" class="form-control" id="deleteUsername" name="delete_username" required>
    </div>
    <div class="form-group">
        <label for="deletePassword">Password:</label>
        <input type="password" autocomplete="new-password" class="form-control" id="deletePassword"
            name="delete_password" required>
    </div>
    <div class="form-check">
        <input class="form-check-input" type="checkbox" id="confirmDelete" name="confirm_delete" required>
        <label class="form-check-label" for="confirmDelete">
            I confirm that I want to delete my account.
        </label>
    </div>
    <div class="button-group">
        <button title="Delete Account" type="submit" class="btn btn-danger"><img src="static\images\icons8-done.svg" alt="Delete Account Icon" style="width: 20px; height: 20px;">
        </button>
        <button title="Cancel" type="button" class="btn btn-secondary" id="cancelDeleteAccount"><img src="static\images\icons8-close.svg" alt="Delete Account Icon" style="width: 20px; height: 20px;">
        </button>
    </div>
</form>
</div>

    <!-- Logout Button -->
        <a href="{{ url_for('login') }}" class="btn-signout btn-warning mt-3">
            <img src="{{ url_for('static', filename='images/icons8-unavailable.svg') }}" title="Sign Out" alt="Sign Out Icon"
                style="width: 20px; height: 20px;"> Sign Out
        </a>
        
        </div>
    </div>

<script>
    let currentOpenFormId = null;

    // Function to hide the currently open form
    function hideCurrentOpenForm() {
        if (currentOpenFormId) {
            const currentForm = document.getElementById(currentOpenFormId);
            currentForm.style.display = 'none';

            // Also, remove the 'selected' class from the button associated with the currently open form
            const currentButton = document.querySelector(`button[id="${currentOpenFormId.replace("Form", "Button")}"]`);
            if (currentButton) {
                currentButton.classList.remove('selected');
            }

            currentOpenFormId = null; // No form is open
        }
    }

    // Function to toggle form visibility and button selected state
    function toggleForm(formId, button) {
        const form = document.getElementById(formId);
        // Check if the clicked form is already open
        const isFormOpen = form.style.display === 'block';

        if (!isFormOpen) {
            // Hide the currently open form (if any)
            if (currentOpenFormId) {
                const currentForm = document.getElementById(currentOpenFormId);
                currentForm.style.display = 'none';
                // Also, remove the 'selected' class from the button associated with the currently open form
                const currentButton = document.querySelector(`button[id="${currentOpenFormId.replace("Form", "Button")}"]`);
                if (currentButton) {
                    currentButton.classList.remove('selected');
                }
            }

            // Update the current open form ID
            currentOpenFormId = formId;

            form.style.display = 'block';
            button.classList.add('selected');
        } else {
            form.style.display = 'none';
            button.classList.remove('selected');
            currentOpenFormId = null; // No form is open
        }
    }

    // Function to hide all forms (using the hideCurrentOpenForm function)
    function hideAllForms() {
        hideCurrentOpenForm();
    }    

    // Add event listeners for buttons
    document.getElementById('updateEmailButton').addEventListener('click', function () {
        toggleForm('updateEmailForm', this);
    });

    document.getElementById('updateApiKeyButton').addEventListener('click', function () {
        toggleForm('updateApiKeyForm', this);
    });

    document.getElementById('resetPasswordButton').addEventListener('click', function () {
        toggleForm('resetPasswordForm', this);
    });

    document.getElementById('deleteAccountButton').addEventListener('click', function () {
        toggleForm('deleteAccountForm', this);
    });

    // Add event listeners for cancel buttons
    document.getElementById('cancelEmailUpdate').addEventListener('click', function () {
        hideAllForms();
    });

    document.getElementById('cancelApiKeyUpdate').addEventListener('click', function () {
        hideAllForms();
    });

    document.getElementById('cancelPasswordUpdate').addEventListener('click', function () {
        hideAllForms();
    });

    document.getElementById('cancelDeleteAccount').addEventListener('click', function () {
        hideAllForms();
    });


</script>
