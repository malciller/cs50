<div class="chat-container">
    <div id="chatMessages" class="chat-messages">
        <!-- Chat messages will be displayed here -->
    </div>
    <div class="chat-input-container">
        <textarea id="chatInput" placeholder="Type a message..." class="chat-input"></textarea>
        <button onclick="sendMessage()" class="send-button">
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAACLElEQVR4nO3YS6hNYRTA8d/1yqs8YqYIIcprQvdKGRgoBiZKtwxMDiGJiTJABgh1MzViQDERJheZyNDAY2Dgka6UgVC4uO7Wrq12OvbZe5/Xt+v+a832d85/rbO+71v7MMYYeViKA9iLWSrCapzEM0SpeBlqEj1Yj7OJZJQRewTCeGzCRQw1kE7H/m5Lb8AA3heQTseyTktPwTZcxqeS0lESTzslPTUl/aVJ6SgVJ9opPRu7cAvDLZSOUrGq1dJzU9I/2yQdJfGqVdLzcRAP8bvN0lEqzjQjvTAlPdpB6SgV64pKr8BxPO+ScJSKoeSya0gfLuBNh8RGc+6d+LLLZCLudKGq53K2ZHxjZ7Kzw/JXsRjvcjz7IbnBMzncIfGPSbFirudccynvzP29zfJ3MS/5vvjuyLtui5z0YhAjLRb/lhzBf0+RBficc208O03SxEjQ7O36BCtTnz0ODwqsv1JUvlXJxL/i6TrVO1qwANubTaBMMq+xsc76NfhRQP4rprUygTzJxOPz9DrPT07aqUj1b+gQ8URaw9aMZwZK7J9+gbC5xAA4jBkCYCbelqj+bYFwreTxu1sA9JeUH0n2VdeplUzgvkCYg18lEtgnIO4VlB9NDXyq2EaPBEbRNjoiQIq00SIBkreNHguUvG10TMDkaaPlAqZRG70QOI3a6JQKkNVGa1WAWsYraI8K8L82Oq9CDNZJoFeF6PvnH8CbKsgSHMIOTOi2zBia4A+MKPC3F51e4QAAAABJRU5ErkJggg=="
                title="Send" alt="Send Icon" style="width: 20px; height: 20px;">
        </button>
    </div>
</div>
<script>
        function sendMessage() {
            var input = document.getElementById("chatInput");
            var message = input.value.trim();
            input.value = '';

            if (message === '') {
                return; // Don't send empty messages
            }

            appendMessage("User", message);

            fetch('/send_message', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ message: message })
            })
                .then(response => response.json())
                .then(data => {
                    console.log("Received Data:", data); // Debugging statement
                    if (data && data.response) {
                        appendMessage("ChatBot", data.response);
                    } else {
                        console.log("No valid response in data"); // Debugging statement
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        function appendMessage(sender, text) {
            var chatMessages = document.getElementById("chatMessages");
            var codeBlockRegex = /```(.*?)\n([\s\S]*?)```/g;
            var match;
            var lastIndex = 0;
            var hasCodeBlock = false;
            var firstMessage = true;

            function appendNormalText(content) {
                var messageElement = document.createElement("p");
                messageElement.textContent = firstMessage ? sender + ": " + content : content;
                chatMessages.appendChild(messageElement);
                firstMessage = false;
            }

            function appendCodeBlock(title, codeSnippet) {
                var codeContainer = document.createElement("div");
                codeContainer.className = "code-container";

                var codeToolbar = document.createElement("div");
                codeToolbar.className = "code-toolbar";

                if (title) {
                    var toolbarTitle = document.createElement("span");
                    toolbarTitle.className = "code-toolbar-title";
                    toolbarTitle.textContent = title;
                    codeToolbar.appendChild(toolbarTitle);
                }

                var copyButton = document.createElement("button");
                copyButton.className = "copy-button";
                copyButton.textContent = "Copy";
                copyButton.onclick = function () { copyToClipboard(codeSnippet); };

                codeToolbar.appendChild(copyButton);
                codeContainer.appendChild(codeToolbar);

                var codeBlock = document.createElement("textarea");
                codeBlock.className = "code-block";
                codeBlock.value = codeSnippet;
                codeBlock.readOnly = true;

                codeContainer.appendChild(codeBlock);
                chatMessages.appendChild(codeContainer);
            }

            while ((match = codeBlockRegex.exec(text)) !== null) {
                hasCodeBlock = true;
                var normalText = text.substring(lastIndex, match.index);
                var title = match[1].trim();
                var codeSnippet = match[2];

                if (normalText) {
                    appendNormalText(normalText);
                }

                appendCodeBlock(title, codeSnippet);
                lastIndex = codeBlockRegex.lastIndex;
            }

            if (hasCodeBlock && lastIndex < text.length) {
                var remainingText = text.substring(lastIndex);
                appendNormalText(remainingText);
            }

            if (!hasCodeBlock) {
                appendNormalText(text);
            }

            chatMessages.scrollTop = chatMessages.scrollHeight;
        }



    function copyToClipboard(codeSnippet) {
        // Create a temporary textarea element to hold the text
        var tempTextArea = document.createElement('textarea');
        // Set its value to the code snippet
        tempTextArea.value = codeSnippet;
        // Append it to the body temporarily
        document.body.appendChild(tempTextArea);
        // Select the content
        tempTextArea.select();
        // Execute the "Copy" command
        document.execCommand('copy');
        // Remove the temporary textarea
        document.body.removeChild(tempTextArea);

        console.log('Text copied to clipboard');
    }



    
</script>

